<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.summit.dao.repository.LockProcessDao">
  <resultMap id="BaseResultMap" type="com.summit.dao.entity.LockProcess">
    <result column="process_id" jdbcType="VARCHAR" property="processId" />
    <result column="device_ip" jdbcType="VARCHAR" property="deviceIp" />
    <result column="lock_code" jdbcType="VARCHAR" property="lockCode" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="process_type" jdbcType="INTEGER" property="processType" />
    <result column="process_result" jdbcType="VARCHAR" property="processResult" />
    <result column="fail_reason" jdbcType="VARCHAR" property="failReason" />
<!--    <result column="face_panorama_id" jdbcType="VARCHAR" property="facePanoramaId" />-->
<!--    <result column="face_pic_id" jdbcType="VARCHAR" property="facePicId" />-->
<!--    <result column="face_match_id" jdbcType="VARCHAR" property="faceMatchId" />-->
    <result column="process_time" jdbcType="TIMESTAMP" property="processTime" />

    <association property="facePanorama" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi1_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi1_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi1_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi1_des" jdbcType="LONGVARCHAR" property="description" />
    </association>
    <association property="facePic" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi2_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi2_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi2_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi2_des" jdbcType="LONGVARCHAR" property="description" />
    </association>
    <association property="faceMatch" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi3_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi3_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi3_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi3_des" jdbcType="LONGVARCHAR" property="description" />
    </association>

  </resultMap>
  <sql id="Base_Column_List">
    process_id, device_ip, lock_code, user_id, user_name, process_type, process_result, 
    fail_reason, face_panorama_id, face_pic_id, face_match_id, process_time
  </sql>
  <sql id="Lock_Have_Alias_List">
    lo.process_id, lo.device_ip, lo.lock_code, lo.user_id, lo.user_name, lo.process_type, lo.process_result,
    lo.fail_reason, lo.face_panorama_id, lo.face_pic_id, lo.face_match_id, lo.process_time
  </sql>
<!--  <sql id="File_Have_Alias_List">-->
<!--    fi.file_id, fi.filen_name, fi.file_path, fi.description-->
<!--  </sql>-->

  <select id="selectByLockCode" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    fi1.file_id fi1_id, fi1.filen_name fi1_name, fi1.file_path fi1_path, fi1.description fi1_des,
    fi2.file_id fi2_id, fi2.filen_name fi2_name, fi2.file_path fi2_path, fi2.description fi2_des,
    fi3.file_id fi3_id, fi3.filen_name fi3_name, fi3.file_path fi3_path, fi3.description fi3_des
    from lock_process lo join file_info fi1 on lo.face_panorama_id=fi1.file_id
    join file_info fi2 on lo.face_pic_id=fi2.file_id
    join file_info fi3 on lo.face_match_id=fi3.file_id
    <where>
      lo.lock_code=#{lockCode}
    </where>
  </select>

  <select id="selectCondition"  resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    fi1.file_id fi1_id, fi1.filen_name fi1_name, fi1.file_path fi1_path, fi1.description fi1_des,
    fi2.file_id fi2_id, fi2.filen_name fi2_name, fi2.file_path fi2_path, fi2.description fi2_des,
    fi3.file_id fi3_id, fi3.filen_name fi3_name, fi3.file_path fi3_path, fi3.description fi3_des
    from lock_process lo join file_info fi1 on lo.face_panorama_id=fi1.file_id
    join file_info fi2 on lo.face_pic_id=fi2.file_id
    join file_info fi3 on lo.face_match_id=fi3.file_id
    <where>
      <if test="lockProcess.processId != null">
        lo.process_id = #{lockProcess.processId}
      </if>
      <if test="lockProcess.deviceIp != null">
        and lo.device_ip = #{lockProcess.deviceIp}
      </if>
      <if test="lockProcess.lockCode != null">
        and lo.process_id = #{lockProcess.lockCode}
      </if>
      <if test="lockProcess.userId != null">
        and lo.user_id = #{lockProcess.userId}
      </if>
      <if test="lockProcess.userName != null">
        and lo.user_name = #{lockProcess.userName}
      </if>
      <if test="lockProcess.processType != null">
        and lo.process_type = #{lockProcess.processType}
      </if>
      <if test="lockProcess.processResult != null">
        and lo.process_result = #{lockProcess.processResult}
      </if>
      <if test="lockProcess.failReason != null">
        and lo.fail_reason = #{lockProcess.failReason}
      </if>
      <if test="start != null">
        and lo.process_time &gt;= #{start}
      </if>
      <if test="end != null">
        and lo.process_time &lt;= #{end}
      </if>
    </where>
  </select>


</mapper>