<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.summit.dao.repository.LockProcessDao">
  <resultMap id="BaseResultMap" type="com.summit.dao.entity.LockProcess">
    <result column="process_id" jdbcType="VARCHAR" property="processId" />
    <result column="device_ip" jdbcType="VARCHAR" property="deviceIp" />
    <result column="lock_code" jdbcType="VARCHAR" property="lockCode" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="process_type" jdbcType="INTEGER" property="processType" />
    <result column="process_result" jdbcType="VARCHAR" property="processResult" />
    <result column="fail_reason" jdbcType="VARCHAR" property="failReason" />
<!--    <result column="face_panorama_id" jdbcType="VARCHAR" property="facePanoramaId" />-->
<!--    <result column="face_pic_id" jdbcType="VARCHAR" property="facePicId" />-->
<!--    <result column="face_match_id" jdbcType="VARCHAR" property="faceMatchId" />-->
    <result column="process_time" jdbcType="TIMESTAMP" property="processTime" />

    <association property="facePanorama" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi1_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi1_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi1_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi1_des" jdbcType="LONGVARCHAR" property="description" />
    </association>
    <association property="facePic" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi2_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi2_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi2_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi2_des" jdbcType="LONGVARCHAR" property="description" />
    </association>
    <association property="faceMatch" javaType="com.summit.dao.entity.FileInfo">
      <result column="fi3_id" jdbcType="VARCHAR" property="fileId" />
      <result column="fi3_name" jdbcType="VARCHAR" property="filenName" />
      <result column="fi3_path" jdbcType="LONGVARCHAR" property="filePath" />
      <result column="fi3_des" jdbcType="LONGVARCHAR" property="description" />
    </association>

  </resultMap>
  <sql id="Base_Column_List">
    process_id, device_ip, lock_code, user_id, user_name, process_type, process_result, 
    fail_reason, face_panorama_id, face_pic_id, face_match_id, process_time
  </sql>
  <sql id="Lock_Have_Alias_List">
    lo.process_id, lo.device_ip, lo.lock_code, lo.user_id, lo.user_name, lo.process_type, lo.process_result,
    lo.fail_reason, lo.face_panorama_id, lo.face_pic_id, lo.face_match_id, lo.process_time
  </sql>
<!--  <sql id="File_Have_Alias_List">-->
<!--    fi.file_id, fi.file_name, fi.file_path, fi.description-->
<!--  </sql>-->

  <select id="selectLockProcessById" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    fi1.file_id fi1_id, fi1.file_name fi1_name, fi1.file_path fi1_path, fi1.description fi1_des,
    fi2.file_id fi2_id, fi2.file_name fi2_name, fi2.file_path fi2_path, fi2.description fi2_des,
    fi3.file_id fi3_id, fi3.file_name fi3_name, fi3.file_path fi3_path, fi3.description fi3_des
    from lock_process lo left join file_info fi1 on lo.face_panorama_id=fi1.file_id
    left join file_info fi2 on lo.face_pic_id=fi2.file_id
    left join file_info fi3 on lo.face_match_id=fi3.file_id
    <where>
      lo.process_id=#{processId}
    </where>
  </select>

  <select id="selectByLockCode" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    fi1.file_id fi1_id, fi1.file_name fi1_name, fi1.file_path fi1_path, fi1.description fi1_des,
    fi2.file_id fi2_id, fi2.file_name fi2_name, fi2.file_path fi2_path, fi2.description fi2_des,
    fi3.file_id fi3_id, fi3.file_name fi3_name, fi3.file_path fi3_path, fi3.description fi3_des
    from lock_process lo left join file_info fi1 on lo.face_panorama_id=fi1.file_id
    left join file_info fi2 on lo.face_pic_id=fi2.file_id
    left join file_info fi3 on lo.face_match_id=fi3.file_id
    <where>
      lo.lock_code=#{lockCode}
    </where>
    <if test="page != null and page.current != null and  page.pageSize != null ">
      limit #{page.current},#{page.pageSize}
    </if>
  </select>

  <select id="selectCondition"  resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    fi1.file_id fi1_id, fi1.file_name fi1_name, fi1.file_path fi1_path, fi1.description fi1_des,
    fi2.file_id fi2_id, fi2.file_name fi2_name, fi2.file_path fi2_path, fi2.description fi2_des,
    fi3.file_id fi3_id, fi3.file_name fi3_name, fi3.file_path fi3_path, fi3.description fi3_des
    from lock_process lo left join file_info fi1 on lo.face_panorama_id=fi1.file_id
    left join file_info fi2 on lo.face_pic_id=fi2.file_id
    left join file_info fi3 on lo.face_match_id=fi3.file_id
    <where>
      <if test="lockProcess.processId != null">
        lo.process_id = #{lockProcess.processId}
      </if>
      <if test="lockProcess.deviceIp != null">
        and lo.device_ip = #{lockProcess.deviceIp}
      </if>
      <if test="lockProcess.lockCode != null">
        and lo.process_id = #{lockProcess.lockCode}
      </if>
      <if test="lockProcess.userId != null">
        and lo.user_id = #{lockProcess.userId}
      </if>
      <if test="lockProcess.userName != null">
        and lo.user_name = #{lockProcess.userName}
      </if>
      <if test="lockProcess.processType != null">
        and lo.process_type = #{lockProcess.processType}
      </if>
      <if test="lockProcess.processResult != null">
        and lo.process_result = #{lockProcess.processResult}
      </if>
      <if test="lockProcess.failReason != null">
        and lo.fail_reason = #{lockProcess.failReason}
      </if>
      <if test="start != null">
        and lo.process_time &gt;= #{start}
      </if>
      <if test="end != null">
        and lo.process_time &lt;= #{end}
      </if>
    </where>
    <if test="page != null and page.current != null and  page.pageSize != null ">
      limit #{page.current},#{page.pageSize}
    </if>
  </select>

  <insert id="insertRecord" parameterType="com.summit.dao.entity.LockProcess">
    insert into lock_process
      <trim prefix="(" suffix=")" suffixOverrides=",">
        <if test="processId != null">
          process_id,
        </if>
        <if test="deviceIp != null">
          device_ip,
        </if>
        <if test="lockCode != null">
          lock_code,
        </if>
        <if test="userId != null">
          user_id,
        </if>
        <if test="userName != null">
          user_name,
        </if>
        <if test="processType != null">
          process_type,
        </if>
        <if test="processResult != null">
          process_result,
        </if>
        <if test="failReason != null">
          fail_reason,
        </if>
        <if test="facePanorama != null and facePanorama.fileId != null">
          face_panorama_id,
        </if>
        <if test="facePic != null and facePic.fileId != null">
          face_pic_id,
        </if>
        <if test="faceMatch != null and faceMatch.fileId != null">
          face_match_id,
        </if>
        <if test="processTime != null">
          process_time,
        </if>
      </trim>
      <trim prefix="values (" suffix=")" suffixOverrides=",">
        <if test="processId != null">
          #{processId},
        </if>
        <if test="deviceIp != null">
          #{deviceIp},
        </if>
        <if test="lockCode != null">
          #{lockCode},
        </if>
        <if test="userId != null">
          #{userId},
        </if>
        <if test="userName != null">
          #{userName},
        </if>
        <if test="processType != null">
          #{processType},
        </if>
        <if test="processResult != null">
          #{processResult},
        </if>
        <if test="failReason != null">
          #{failReason},
        </if>
        <if test="facePanorama != null and facePanorama.fileId != null">
          #{facePanorama.fileId},
        </if>
        <if test="facePic != null and facePic.fileId != null">
          #{facePic.fileId},
        </if>
        <if test="faceMatch != null and faceMatch.fileId != null">
          #{faceMatch.fileId},
        </if>
        <if test="processTime != null">
          #{processTime},
        </if>
      </trim>
  </insert>

    <update id="updateRecord" parameterType="com.summit.dao.entity.LockProcess">
      update lock_process
      <set>
        <if test="processId != null">
          process_id = #{processId},
        </if>
        <if test="deviceIp != null">
          device_ip = #{deviceIp},
        </if>
        <if test="lockCode != null">
          lock_code = #{lockCode},
        </if>
        <if test="userId != null">
          user_id = #{userId},
        </if>
        <if test="userName != null">
          user_name = #{userName},
        </if>
        <if test="processType != null">
          process_type = #{processType},
        </if>
        <if test="processResult != null">
          process_result = #{processResult},
        </if>
        <if test="failReason != null">
          fail_reason = #{failReason},
        </if>
        <if test="facePanorama != null and facePanorama.fileId != null">
          face_panorama_id = #{facePanorama.fileId},
        </if>
        <if test="facePic != null and facePic.fileId != null">
          face_pic_id = #{facePic.fileId},
        </if>
        <if test="faceMatch != null and faceMatch.fileId != null">
          face_match_id = #{faceMatch.fileId},
        </if>
        <if test="processTime != null">
          process_time = #{processTime}
        </if>
      </set>
      <where>
        process_id = #{processId}
      </where>
    </update>

</mapper>