<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.summit.dao.repository.LockInfoDao">
  <resultMap id="BaseResultMap" type="com.summit.dao.entity.LockInfo">
    <result column="lock_id" jdbcType="VARCHAR" property="lockId" />
    <result column="lock_code" jdbcType="VARCHAR" property="lockCode" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="updatetime" jdbcType="TIMESTAMP" property="updatetime" />

    <collection property="devices" ofType="com.summit.dao.entity.CameraDevice" >
      <result column="dev_id" jdbcType="VARCHAR" property="devId" />
      <result column="device_ip" jdbcType="VARCHAR" property="deviceIp" />
      <result column="lock_code" jdbcType="VARCHAR" property="lockCode" />
      <result column="status" jdbcType="VARCHAR" property="status" />
    </collection>
  </resultMap>

  <sql id="Base_Column_List">
    lock_id, lock_code, status, updatetime
  </sql>
  <sql id="Lock_Have_Alias_List">
    li.lock_id, li.lock_code, li.status, li.updatetime
  </sql>
  <sql id="Device_Have_Alias_List">
    cd.dev_id, cd.device_ip, cd.lock_code, cd.status
  </sql>

  <select id="selectBylockCode" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    <include refid="Device_Have_Alias_List" />
    from lock_info li join camera_device cd on li.lock_code = cd.lock_code
    <where>
      li.lock_code=#{lockCode}

    </where>
  </select>

  <select id="selectCondition" parameterType="com.summit.dao.entity.LockInfo" resultMap="BaseResultMap">
    select
    <include refid="Lock_Have_Alias_List" />,
    <include refid="Device_Have_Alias_List" />
    from lock_info li join camera_device cd on li.lock_code = cd.lock_code
    <where>
      <if test="lockId != null">
        li.lock_id = #{lockId}
      </if>
      <if test="lockCode != null">
        and li.lock_code = #{lockCode}
      </if>
      <if test="status != null">
        and li.status = #{status}
      </if>
      <if test="updatetime != null">
        and li.updatetime = #{updatetime}
      </if>
    </where>
  </select>

</mapper>